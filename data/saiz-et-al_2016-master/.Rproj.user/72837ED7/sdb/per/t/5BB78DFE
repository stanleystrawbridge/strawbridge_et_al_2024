{
    "collab_server" : "",
    "contents" : "# Saiz *et al* (2016)\n# Figures 1, S1 and S2 plots\n\n# Load data and apply transformations if not loaded yet\ndata.ok <- exists('FGF.all') \ntables.ok <- exists('FGF.sum')\nif (data.ok == FALSE) {\n        source('Transformations.R')\n}\nrm(data.ok)\nif (tables.ok == FALSE) {\n        source('tables.R')\n}\nrm(tables.ok)\n\n# Create vector for identity colors\nidcols <- c('EPI' = 'red', 'PRE' = 'blue', 'DP' = 'purple', 'DN' = 'gray', \n            'TE' = 'green', 'ICM' = 'purple')\n\n# Figure 1c\n## Scatter plots showing the levels of GATA6 and NANOG in linear scale\n## in individual ICM ccells of embryos collected at sequential stages\n## of development as in Fig. 1b ('Littermates', blastocysts of >= 32 cells)\n## Each dot represents a single ICM cell\n# FGF.all$ratio <- FGF.all$CH4.ebLogCor - FGF.all$CH5.ebLogCor\nfig1c <- ggplot(FGF.all %>% \n                        ## Select ICM cells of Littermates with 32 or more cells\n                        ## and exclude embryos from Aug 20, 2015 experiment\n                        filter(Treatment == 'Littermate',\n                               Exp_date != '20150820', \n                               TE_ICM != 'TE', \n                               Stage != '<32'),\n                ## Plot corrected fluorescence levels \n                ## of GATA6 (CH4) vs NANOG (CH5) on linear scale\n                aes(x = exp(CH4.ebLogCor), y = exp(CH5.ebLogCor)))\n## Color-code points for identity assigned by thresholding linear scale data\nfig1c <- fig1c + geom_point(aes(color = Identity.lin), size = I(1.2))\nfig1c <- fig1c + scale_color_manual(values = idcols)\n## Draw thresholds (50 a.u. on both axes)\nfig1c <- fig1c + geom_vline(xintercept = 50, linetype = 2)\nfig1c <- fig1c + geom_hline(yintercept = 50, linetype = 2)\n## Set limits for X and Y axes\nfig1c <- fig1c + xlim(0, 255) + ylim(0, 255)\n## Set aesthetis for the plot\nfig1c <- fig1c + theme_bw()\nfig1c <- fig1c + labs(color = 'Identity', x = '[GATA6]', y = '[NANOG]')\nfig1c <- fig1c + coord_fixed()\n## Bin cells by stage\nfig1c <- fig1c + facet_grid( ~ Stage)\n## Print the plot to the screen\nprint(fig1c)\n\n# Figure 1d\n## Scatter plots showing the levels of GATA6 and NANOG in log scale\n## in individual ICM cells of embryos collected at sequential stages \n## of development as in Fig. 1b ('Littermates', from 32-cells onwards). \n## Each dot represents a single ICM cell.\nfig1d <- ggplot(FGF.all %>% \n                        ## Select ICM cells of Littermates with 32 or more cells\n                        ## and exclude embryos from Aug 20, 2015 experiment\n                        filter(Treatment == 'Littermate',\n                               Exp_date != '20150820', \n                               TE_ICM != 'TE', \n                               Stage != '<32'),\n                ## Plot corrected log of GATA6 (CH4) vs NANOG (CH5) fluorescence\n                aes(x = CH4.ebLogCor, y = CH5.ebLogCor))\n## Color-code for identity, as assigned by k-means clustering on log scale data\nfig1d <- fig1d + geom_point(aes(color = Identity.km), size = I(1.2))\nfig1d <- fig1d + scale_color_manual(values = idcols)\n## Overlay estimated density contour lines\nfig1d <- fig1d + geom_density2d(color = I('orangered4'), size = 0.5)\n## Set limits for X and Y axes\nfig1d <- fig1d + xlim(-5, 9) + ylim(-5, 9)\n## Set aesthetis for the plot\nfig1d <- fig1d + theme_bw()\nfig1d <- fig1d + labs(color = 'Identity', x = 'log[GATA6]', y = 'log[NANOG]')\nfig1d <- fig1d + coord_fixed()\n# Bin cells by stage\nfig1d <- fig1d + facet_grid( ~ Stage)\n## Print the plot to the screen\nprint(fig1d)\n\n# Figure 1e\n## Bar plot representing the lineage composition for each embryo in Fig. 1c \n## ordered by total cell number, represented as percentage of the total\nfig1e <- ggplot(FGF.all %>% \n                        ## Select Littermates with 32 or more cells\n                        ## and exclude embryos from Aug 20, 2015 experiment\n                        filter(Treatment == 'Littermate',\n                               Exp_date != '20150820', \n                               Stage != '<32'),\n                ## Plot single embryos, ordered by total cell number, on the X axis\n                ## and identity (% of total), assigned by k-means clustering, \n                ## on the Y axis\n                aes(x = reorder(Embryo_ID, Cellcount), fill = Identity.km), \n                na.rm = TRUE)\nfig1e <- fig1e + geom_bar(position = 'fill')\n## Color-code for identity\nfig1e <- fig1e + scale_fill_manual(values = idcols)\n## Set aesthetics for the plot\nfig1e <- fig1e + theme_bw() + theme(axis.text.x = element_text(angle = 45, hjust = 1))\nfig1e <- fig1e + labs(fill = 'Identity', x = 'Total cell number', y = '% of total')\nfig1e <- fig1e + coord_fixed(25)\n## Print the plot to the screen\nprint(fig1e)\n\n# Figure 1f\n## Bar plots representing the average lineage composition of embryos in Fig. 1c\n## binned into five developmental stages \nfig1f <- ggplot(FGF.all %>% \n                        ## Select Littermates with 32 or more cells\n                        ## and exclude embryos from Aug 20, 2015 experiment\n                        filter(Treatment == 'Littermate',\n                               Exp_date != '20150820', \n                               Stage != '<32'), \n                ## Plot stage on the X axis\n                ## and identity (% of total), assigned by k-means clustering, \n                ## on the Y axis\n             aes(x = Stage, fill = Identity.km))\nfig1f <- fig1f + geom_bar(position = 'fill')\n## Color-code for identity\nfig1f <- fig1f + scale_fill_manual(values = idcols)\n## Set aesthetis for the plot\nfig1f <- fig1f + theme_bw() + theme(axis.text.x = element_text(angle = 45, hjust = 1))\nfig1f <- fig1f + labs(fill = 'Identity', x = 'Stage', y = '% of total')\nfig1f <- fig1f + coord_fixed(10)\n## Print the plot to the screen\nprint(fig1f)\n\n# Figure 1g\n## Bar plots representing the ICM composition for each embryo in Fig. 1c\n## ordered by total cell number, represented as percentage of ICM cells\nfig1g <- ggplot(FGF.all %>% \n                        ## Select Littermates with 32 or more cells\n                        ## and exclude embryos from Aug 20, 2015 experiment\n                        filter(Treatment == 'Littermate', \n                               Exp_date != '20150820', \n                               TE_ICM == 'ICM',\n                               Stage != '<32'), \n                ## Plot single embryos, ordered by total cell number, on the X axis\n                ## and identity (% of ICM), assigned by k-means clustering, \n                ## on the Y axis\n                aes(x = reorder(Embryo_ID, Cellcount), fill = Identity.km), \n                na.rm = TRUE)\nfig1g <- fig1g + geom_bar(position = 'fill')\n## Color-code for identity\nfig1g <- fig1g + scale_fill_manual(values = idcols)\n## Set up aesthetics for the plot\nfig1g <- fig1g + theme_bw() + theme(axis.text.x = element_text(angle = 45, hjust = 1))\nfig1g <- fig1g + labs(fill = 'Identity', x = 'Total cell number', y = '% of ICM')\nfig1g <- fig1g + coord_fixed(25)\n## Print the plot to the screen\nprint(fig1g)\n\n# Figure 1h\n## Bar plots representing the average ICM composition of embryos in Fig. 1c\n## binned in five developmental stages \nfig1h <- ggplot(FGF.all %>% \n                        ## Select Littermates with 32 or more cells\n                        ## and exclude embryos from Aug 20, 2015 experiment\n                        filter(Treatment == 'Littermate',\n                               Exp_date != '20150820', \n                               TE_ICM == 'ICM',\n                               Stage != '<32'), \n                ## Plot stage on the X axis\n                ## and identity (% of ICM), assigned by k-means clustering, \n                ## on the Y axis\n                aes(x = Stage, fill = Identity.km))\nfig1h <- fig1h + geom_bar(position = 'fill')\n## Color-code for identity\nfig1h <- fig1h + scale_fill_manual(values = idcols)\n## Set up aesthetics for the plot\nfig1h <- fig1h + theme_bw() + theme(axis.text.x = element_text(angle = 45, hjust = 1))\nfig1h <- fig1h + labs(fill = 'Identity', x = 'Stage', y = '% of ICM')\nfig1h <- fig1h + coord_fixed(10)\n## Print the plot to the screen\nprint(fig1h)\n\n# ------------------------------------------------------------------------------\n\n# Figure S1a\n## Boxplot of total cell number for embryos in Fig. 1\n## binned by developmental stage\nfigS1a <- ggplot(FGF.all %>% \n                         ## Select Littermates only with >32 cells\n                         ## and exclude experiment from 08/20/2015\n                         filter(Treatment == 'Littermate', \n                                Exp_date != '20150820', \n                                Stage != '<32') %>% \n                         group_by(Embryo_ID, \n                                  Treatment, \n                                  Cellcount, \n                                  Stage) %>%\n                         summarise(), \n                 aes(x = Stage, y = Cellcount))\n## Create boxplots for each stage\nfigS1a <- figS1a + geom_boxplot(fill = 'gray', color = 'black', \n                                outlier.shape = 1)\n## Overlay a dot for each embryo's cell count\nfigS1a <- figS1a + geom_jitter(size = I(1.2), color = 'black')\n## Set up Y-axis limits and aesthetics for the plot\nfigS1a <- figS1a + ylim(0, 200) + theme_bw() + coord_fixed(1/20)\nfigS1a <- figS1a + labs(x = 'Stage', y = 'Total cell number')\n## Print the plot to the screen\nprint(figS1a)\n\n# Figure S1b\n## Boxplot of number of cells in each ICM denomination\n## for embryos in Fig. 1\n## binned by developmental stage\nfigS1b <- ggplot(FGF.ICMsum %>%\n                         ## Select Littermates with more than 32 cells\n                         filter(Treatment == 'Littermate', \n                                Stage != '<32'), \n                 ## Plot number of cells for each lineage on the Y axis\n                 aes(x = Stage, y = Count))\n## Create boxplots for each lineage, for each stage\n## and color boxes for identity, assigned by k-means clustering\nfigS1b <- figS1b + geom_boxplot(aes(fill = Identity.km), color = I('black'), \n                                outlier.shape = 1)\n## Overlay a dot for each lineage's cell count (per embryo)\n#figS1b <- figS1b + geom_jitter(aes(color = Identity.auto), size = I(1.2))\n## Color-code for identity\nfigS1b <- figS1b + scale_fill_manual(values = idcols)\n## Set up aesthetics for the plot\nfigS1b <- figS1b + theme_bw() + coord_fixed(0.15) + ylim(0, 60)\nfigS1b <- figS1b + labs(fill = 'Identity', x = 'Stage', y = 'Number of cells')\n## Print the plot to the screen\nprint(figS1b)\n\n# Figure S1c\n## Boxplot of number of cells in TE and ICM\n## for embryos in Fig. 1\n## binned by developmental stage\nfigS1c <- ggplot(FGF.sum %>% \n                         ## Select Littermates with more than 32 cells\n                         filter(Treatment == 'Littermate', \n                                Stage != '<32'), \n                 ## Plot number of ICM or TE cells on the Y axis\n                 aes(x = Stage, y = Count))\nfigS1c <- figS1c + geom_boxplot(aes(fill = TE_ICM), color = I('black'), \n                                outlier.shape = 1)\nfigS1c <- figS1c + geom_jitter(aes(shape = TE_ICM), color = 'black', \n                               size = I(1.2))\nfigS1c <- figS1c + scale_fill_manual(values = idcols)\nfigS1c <- figS1c + theme_bw() + coord_fixed(0.075)\nfigS1c <- figS1c + labs(fill = 'Identity', x = 'Stage', y = 'Number of cells')\nprint(figS1c)\n\n# Figure S1d\n## Bar plot representing the lineage composition for each embryo in Fig. 1c \n## (all lineages)\n## ordered by total cell number, represented as cells per lineage\nfigs1d <- ggplot(FGF.all %>% \n                         ## Select Littermates only with >32 cells\n                         ## and exclude experiment from 08/20/2015\n                        filter(Treatment == 'Littermate',\n                               Exp_date != '20150820', \n                               Stage != '<32'),\n                ## Plot single embryos, ordered by total cell number, on the X axis\n                ## and identity (% of total), assigned by k-means clustering, \n                ## on the Y axis\n                aes(x = reorder(Embryo_ID, Cellcount), fill = Identity.km), \n                na.rm = TRUE)\nfigs1d <- figs1d + geom_bar()\n## Color-code for identity\nfigs1d <- figs1d + scale_fill_manual(values = idcols)\n## Set aesthetics for the plot\nfigs1d <- figs1d + theme_bw() + theme(axis.text.x = element_text(angle = 45, \n                                                                 hjust = 1))\nfigs1d <- figs1d + labs(fill = 'Identity', \n                        x = 'Total cell number', y = 'Cell number')\nfigs1d <- figs1d + coord_fixed(0.25)\n## Print the plot to the screen\nprint(figs1d)\n\n# Figure S1e\n## Local regression curves showing the temporal progression\n## in the size of each ICM lineage denomination (as % of the ICM)\n## for Littermates shown in Fig. 1\n\n## Define grid for plotting (PrE, DP, EPI+DN)\npar(mfrow = c(1, 3), mar = c(4, 4, 3, 2), mgp = c(2, 0.7, 0), lwd = 1.5, pty = 's')\n## PrE as % of ICM\nplot(Count/ICM.count ~ Cellcount, data = subset(FGF.ICMsum, \n                                                Treatment == \"Littermate\" & \n                                                        Identity.km == 'PRE'), \n     pch = 16, cex = 0.8, xlim = c(10, 220), ylim = c(0, 1), \n     ylab = 'PrE/ICM', xlab = 'Total cell number')\noo1 <- locfit(Count ~ Cellcount, weights = ICM.count, family = \"binomial\", \n              data = subset(FGF.ICMsum, Treatment == \"Littermate\" & \n                                    Cellcount > 15 & \n                                    Identity.km == 'PRE'))\nplot(oo1, band = \"local\", add = TRUE, col = idcols[2], lwd = 2)\n## DP as % of ICM\nplot(Count/ICM.count ~ Cellcount, data = subset(FGF.ICMsum, \n                                               Treatment == \"Littermate\" & \n                                                       Identity.km == 'DP'), \n     pch = 16, cex = 0.8, xlim = c(10, 220), ylim = c(0, 1), \n     main = 'Littermate', ylab = 'DP/ICM', xlab = 'Total cell number')\noo1 <- locfit(Count ~ Cellcount, weights = ICM.count, family = \"binomial\", \n              data = subset(FGF.ICMsum, Treatment == \"Littermate\" & \n                                    Cellcount > 15 & \n                                    Identity.km == 'DP'))\nplot(oo1, band = \"local\", add = TRUE, col = idcols[3], lwd = 2)\n## EPI+DN as % of ICM\nplot(Count/ICM.count ~ Cellcount, data = subset(FGF.ICMsum, \n                                               Treatment == \"Littermate\" & \n                                                       (Identity.km == 'EPI' | \n                                                                Identity.km == 'DN')), \n     pch = 16, cex = 0.8, xlim = c(10, 220), ylim = c(0, 1), \n     ylab = 'EPI+DN/ICM', xlab = 'Total cell number')\noo1 <- locfit(Count ~ Cellcount, weights = ICM.count, family = \"binomial\", \n              data = subset(FGF.ICMsum, Treatment == \"Littermate\" & \n                                    Cellcount > 15 & \n                                    (Identity.km == 'EPI' | \n                                             Identity.km == 'DN')))\nplot(oo1, band = \"local\", add = TRUE, col = idcols[1], lwd = 2)\n\n## Reset grid to 1x1\npar(mfrow = c(1, 1))\n\n# Figure S2a-c\n## Boxplot for Channels 1 (Hoechst (a)), 4 (GATA6 (b)) and 5 (NANOG (c))\n## after Empirical Bayes correction\n## for ICM cells only, for each experiment, ordered by ascending imaging date\n## Figure S2a\nfigS2a <- ggplot(FGF.all %>% \n                         ## Select ICM cells only\n                         ## for embryos stained for CDX2, GATA6 and NANOG\n                         filter(TE_ICM == 'ICM',\n                                Markers == 'C2G6NG'), \n                 ## Arrange experiments by date and plot against Hoechst (CH1)\n                 aes(x = reorder(Experiment, Exp_date), y = CH1.ebLogCor))\n## Color grey (Hoechst)\nfigS2a <- figS2a + geom_boxplot(fill = I('grey'), color = I('black'), \n                                outlier.shape = 1)\n## Optional: plot all cells as individual points over the box and whiskers\n#figS2a <- figS2a + geom_jitter(alpha = I(0.25), size = I(0.5)) + theme_bw() \nfigS2a <- figS2a + theme(axis.text.x = element_text(angle = 45, hjust = 1))\nfigS2a <- figS2a + labs(x = 'Experiment, by date', y = 'log[Hoechst]')\nprint(figS2a)\n\n## Figure S2b\nfigS2b <- ggplot(FGF.all %>% \n                         ## Select ICM cells only\n                         ## for embryos stained for CDX2, GATA6 and NANOG\n                         filter(TE_ICM == 'ICM',\n                                Markers == 'C2G6NG'), \n                 ## Arrange experiments by date and plot against GATA6 (CH4)\n                 aes(x = reorder(Experiment, Exp_date), y = CH4.ebLogCor))\n## Color blue (GATA6)\nfigS2b <- figS2b + geom_boxplot(fill = I('blue'), color = I('black'), \n                              outlier.shape = 1)\n## Optional: plot all cells as individual points over the box and whiskers\n#figS2b <- figS2b + geom_jitter(alpha = I(0.25), size = I(0.5)) + theme_bw()\nfigS2b <- figS2b + theme(axis.text.x = element_text(angle = 45, hjust = 1))\nfigS2b <- figS2b + labs(x = 'Experiment, by date', y = 'log[GATA6]')\nprint(figS2b)\n\n## Figure S2c\nfigS2c <- ggplot(FGF.all %>% \n                         ## Select ICM cells only\n                         ## for embryos stained for CDX2, GATA6 and NANOG\n                         filter(TE_ICM == 'ICM',\n                                Markers == 'C2G6NG'), \n                 ## Arrange experiments by date and plot against NANOG (CH5)\n                aes(x = reorder(Experiment, Exp_date), y = CH5.ebLogCor))\n## Color red (NANOG)\nfigS2c <- figS2c + geom_boxplot(fill = I('red'), color = I('black'), \n                              outlier.shape = 1)\n## Optional: plot all cells as individual points over the box and whiskers\n#figS2c <- figS2c + geom_jitter(alpha = I(0.25), size = I(0.5)) + theme_bw()\nfigS2c <- figS2c + theme(axis.text.x = element_text(angle = 45, hjust = 1))\nfigS2c <- figS2c + labs(x = 'Experiment, by date', y = 'log[NANOG]')\nprint(figS2c)",
    "created" : 1539289604891.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2694049806",
    "id" : "5BB78DFE",
    "lastKnownWriteTime" : 1538480560,
    "last_content_update" : 1538480560,
    "path" : "C:/Users/Strawbridge/Dropbox/nicholsLab/FgfDependentPopulationDynamics/DATA/theoretical/sheffield2018/saiz2016natureCommunications/saiz-et-al_2016-master/figures_1-S1toS2.R",
    "project_path" : "figures_1-S1toS2.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}