{
    "collab_server" : "",
    "contents" : "# Saiz *et al* (2016)\n# Figures 2, S3 and S4 plots\n\n# Load data and apply transformations if not loaded yet\ndata.ok <- exists('FGF.all') \ntables.ok <- exists('FGF.sum')\nif (data.ok == FALSE) {\n        source('Transformations.R')\n}\nrm(data.ok)\nif (tables.ok == FALSE) {\n        source('tables.R')\n}\nrm(tables.ok)\n\n# Create vector for identity colors\nidcols <- c('EPI' = 'red', 'PRE' = 'blue', 'DP' = 'purple', 'DN' = 'gray', \n            'TE' = 'green', 'ICM' = 'purple')\n\n# Figure 2b\n## Scatter plots showing the levels of GATA6 and NANOG in log scale\n## in individual ICM cells of embryos treated with either FGF4, PD03 or AZD4547\n## for the indicated regimes (stage of collection + treatment length)\n## Each dot represents a single ICM cell, color coded for identity\nfig2b <- ggplot(FGF.all %>% \n                        ## Filter ICM cells of end point embryos \n                        ## stained with CDX2, GATA6 and NANOG\n                        ## for Regimes 1, 5, 3, 4 and 6;\n                        ## treated with FGF4, PD03 or AZD4547, against Controls\n                        filter(Treatment == 'Control' | \n                                       Treatment == 'FGF4_1000' | \n                                       Treatment == 'PD03_1' | \n                                       Treatment == 'AZD_1',\n                               Xpoint != 'xp', \n                               TE_ICM != 'TE', \n                               Markers == 'C2G6NG', \n                               Regime != 'R8', \n                               Regime != 'R9'),\n                ## Plot log(GATA6) against log(NANOG)\n                aes(x = CH4.ebLogCor, y = CH5.ebLogCor))\nfig2b <- fig2b + geom_point(aes(color = Identity.km), size = I(0.75))\nfig2b <- fig2b + geom_density2d(color = I('orangered4'), size = 0.25)\n## Set up axes limits\nfig2b <- fig2b + xlim(0, 8) + ylim(0, 8)\n## Set up plot aesthetics\nfig2b <- fig2b + scale_color_manual(values = idcols)\nfig2b <- fig2b + theme_bw() + coord_fixed()\nfig2b <- fig2b + labs(color = 'Identity', x = 'log[GATA6]', y = 'log[NANOG]')\n## Arrange by Treatment condition (X axis) and Treatment regime (Y axis)\nfig2b <- fig2b + facet_grid(Regime ~ Treatment)\n## Print plot to the screen\nprint(fig2b)\n        \n# Figure 2d\n## Bar plot representing the average lineage composition \n## for each regime in Fig. 2b & c,\n## grouped by treatment condition\nfig2d <- ggplot(FGF.all %>% \n                        ## Filter ICM cells of end point embryos \n                        ## stained with CDX2, GATA6 and NANOG\n                        ## for Regimes 1, 5, 3, 4 and 6;\n                        ## treated with FGF4, PD03 or AZD4547, against Controls\n                        filter(Treatment == 'Control' | \n                                       Treatment == 'FGF4_1000' | \n                                       Treatment == 'PD03_1' | \n                                       Treatment == 'AZD_1', \n                               Xpoint != 'xp', \n                               TE_ICM != 'TE', \n                               Markers == 'C2G6NG', \n                               Regime != 'R8', \n                               Regime != 'R9'),\n                ## Plot each treatment regime against average ICM composition\n                aes(x = Regime, fill = Identity.km))\nfig2d <- fig2d + geom_bar(position = 'fill')\n## Set up plot aesthetics\nfig2d <- fig2d + scale_fill_manual(values = idcols)\nfig2d <- fig2d + theme_bw() + coord_fixed(5)\nfig2d <- fig2d + labs(fill = 'Identity', x = 'Treatment regime', y = '% of ICM')\n## Group by treatment condition\nfig2d <- fig2d + facet_grid( ~ Treatment)\n## Print plot to the screen\nprint(fig2d)\n\n# ------------------------------------------------------------------------------\n\n# Figure S3b\n## Scatter plots showing the levels of GATA6 and NANOG in log scale\n## in individual ICM cells of embryos treated with SU5402 vs Controls\n## for the indicated regimes (stage of collection + treatment length)\n## Each dot represents a single ICM cell, color coded for identity\nfigS3b <- ggplot(FGF.all %>% \n                         ## Filter ICM cells of end point embryos \n                         ## stained with CDX2, GATA6 and NANOG\n                         ## for Regimes 1, 3, and 4;\n                         ## treated with SU5402, against Controls\n                         filter(Treatment == 'Control' | \n                                        Treatment == 'SU_20', \n                                Xpoint != 'xp', \n                                TE_ICM != 'TE', \n                                Markers == 'C2G6NG', \n                                Regime == 'R1' | \n                                        Regime == 'R3' | \n                                        Regime == 'R4'),\n                 ## Plot log(GATA6) against log(NANOG)\n                 aes(x = CH4.ebLogCor, y = CH5.ebLogCor))\nfigS3b <- figS3b + geom_point(aes(color = Identity.km), size = I(0.75))\nfigS3b <- figS3b + geom_density2d(color = I('orangered4'), size = 0.25)\n## Set up axes limits\nfigS3b <- figS3b + xlim(0, 8) + ylim(0, 8)\n## Color-code for identity\nfigS3b <- figS3b + scale_color_manual(values = idcols)\n## Set up aesthetics\nfigS3b <- figS3b + theme_bw() + coord_fixed()\nfigS3b <- figS3b + labs(color = 'Identity', x = 'log[GATA6]', y = 'log[NANOG]')\n## Arrange by Treatment condition (X axis) and Treatment regime (Y axis)\nfigS3b <- figS3b + facet_grid(Treatment ~ Regime)\n## Print plot to the screen\nprint(figS3b)\n\n# Figure S3c\n## Bar plot representing the average lineage composition \n## for embryos treated with SU5402 vs Controls\n## grouped by treatment condition (SU5402 and Control)\nfigS3c <- ggplot(FGF.all %>% \n                         ## Filter ICM cells of end point embryos \n                         ## stained with CDX2, GATA6 and NANOG\n                         ## for Regimes 1, 3, and 4;\n                         ## treated with SU5402, against Controls\n                         filter(Treatment == 'Control' | \n                                        Treatment == 'SU_20', \n                                Xpoint != 'xp', \n                                TE_ICM != 'TE', \n                                Markers == 'C2G6NG', \n                                Regime == 'R1' | \n                                        Regime == 'R3' | \n                                        Regime == 'R4'),\n                ## Plot each treatment regime against ICM composition\n                aes(x = Regime, fill = Identity.km))\nfigS3c <- figS3c + geom_bar(position = 'fill')\n## Set up plot aesthetics\nfigS3c <- figS3c + scale_fill_manual(values = idcols)\nfigS3c <- figS3c + theme_bw() + coord_fixed(3)\nfigS3c <- figS3c + labs(fill = 'Identity', x = 'Treatment regime', y = '% of ICM')\n## Group by treatment condition (Control vs SU5402)\nfigS3c <- figS3c + facet_wrap( ~ Treatment)\n## Print plot to the screen\nprint(figS3c)\n\n# Figure S3d\n## Grid of bar plots representing ICM composition per embryo\n## for embryos treated in all conditions - FGF4, PD03, AZD4547 and SU5402 - \n## arranged by treatment condition (rows) and treatment regime (column)\n## (think a breakdown of Figure 2d + S2c combined)\n## Each bar represents the ICM of a single embryo\nfigS3d <- ggplot(FGF.all %>% \n                         ## Filter ICM cells of end point embryos \n                         ## stained with CDX2, GATA6 and NANOG\n                         ## for Regimes 1, 5, 3, 4 and 6;\n                         ## treated with FGF4, PD03, AZD4547 or SU5402\n                         filter(Treatment != 'Littermate',\n                                Treatment != 'SU_10',\n                                Xpoint != 'xp', \n                                TE_ICM != 'TE', \n                                Markers == 'C2G6NG', \n                                Regime != 'R8', \n                                Regime != 'R9'),\n                 ## Plot each treatment regime against average ICM composition\n                 aes(x = Embryo_ID, fill = Identity.km))\nfigS3d <- figS3d + geom_bar(position = 'fill')\n## Set up plot aesthetics\nfigS3d <- figS3d + scale_fill_manual(values = idcols)\nfigS3d <- figS3d + theme_bw() + coord_fixed(100)\nfigS3d <- figS3d + labs(fill = 'Identity', x = 'Treatment regime', y = '% of ICM')\n## Arange by treatment condition and treatment regime\nfigS3d <- figS3d + facet_wrap( ~ Treatment + Regime, scales = 'free')\n## Print plot to the screen\nprint(figS3d)\n\n# Figure S4a\n## Boxplots showing the total number of cells per embryo\n## for embryos in figures 2 and S3\n## for each treatment condition, grouped by treatment regime\nfigS4a <- ggplot(FGF.all %>%\n                         ## Calculate total cell number per embryo\n                         group_by(Embryo_ID, \n                                  Regime, \n                                  Treatment, \n                                  Experimenter, \n                                  Xpoint, \n                                  Cellcount, \n                                  Stage) %>%\n                         summarise() %>% \n                         ## Select all embryos cultured for 48h\n                         ## (and the corresponding littermates)\n                         ## for each treatment and regime to be plotted\n                         filter(Xpoint != 'xp', \n                                Experimenter == 'NS', \n                                Treatment != 'SU_10', \n                                Regime != 'NA', \n                                Regime != 'R8', \n                                Regime != 'R9'),\n                 aes(x = Treatment, y = Cellcount))\n## Set up plot aesthetics\nfigS4a <- figS4a + geom_boxplot(fill = 'gray', color = 'black', \n                                outlier.shape = 1)\nfigS4a <- figS4a + geom_jitter(size = I(1.2), color = 'black')\nfigS4a <- figS4a + theme_bw() + facet_grid( ~ Regime)\nfigS4a <- figS4a + theme(axis.text.x = element_text(angle = 45, hjust = 1))\nfigS4a <- figS4a + labs(y = 'Total cell number', x = 'Treatment')\nfigS4a <- figS4a + coord_fixed(1/20)\n## Print plot to the screen\nprint(figS4a)\n\n# Figure S4b\n## Boxplots showing the number of cells in each ICM lineage denomination\n## for each treatment regime in figures 2 and S3, grouped by treatment condition\nfigS4b <- ggplot(FGF.ICMsum %>% \n                         ## Select all embryos cultured for 48h\n                         ## stained for CDX2, GATA6 and NANOG\n                         ## for each treatment and regime to be plotted\n                         filter(Treatment != 'Littermate', \n                                Treatment != 'SU_10', \n                                Xpoint != 'xp', \n                                Markers == 'C2G6NG', \n                                Regime != 'NA', \n                                Regime != 'R8', \n                                Regime != 'R9'),\n                 aes(x = Regime, y = Count))\n## Color code for identity\nfigS4b <- figS4b + geom_boxplot(aes(fill = Identity.km), color = I('black'), \n                                outlier.shape = 1)\n## Set up plot aesthetics\nfigS4b <- figS4b + scale_fill_manual(values = idcols)\nfigS4b <- figS4b + theme_bw() + facet_grid( ~ Treatment)\nfigS4b <- figS4b + coord_fixed(1/10)\nfigS4b <- figS4b + labs(x = 'Regime', y = 'Cell number', fill = 'Identity')\n## Print plot to the screen\nprint(figS4b)\n\n# Figure S4c\n## Bar plots showing the average lineage composition for each treatment regime\n## in figures 2 and S3, grouped by treatment condition\nfigS4c <- ggplot(FGF.all %>% \n                         ## Select embryos cultured for 48h\n                         ## for each treatment and regime to be plotted\n                         filter(Xpoint != 'xp', \n                                Treatment != 'Littermate', \n                                Treatment != 'SU_10', \n                                Markers == 'C2G6NG', \n                                Regime != 'NA', \n                                Regime != 'R8', \n                                Regime != 'R9'), \n                 aes(x = Regime, fill = Identity.km))\nfigS4c <- figS4c + geom_bar(position = 'fill')\n## Set up plot aesthetics\nfigS4c <- figS4c + scale_fill_manual(values = idcols)\nfigS4c <- figS4c + theme_bw() + facet_grid( ~ Treatment)\nfigS4c <- figS4c + coord_fixed(5)\nfigS4c <- figS4c + labs(x = 'Regime', y = '% of total', fill = 'Identity')\n## Print plot to the screen\nprint(figS4c)\n        \n# Figure S4d\n## Boxplots showing number of cells in TE and ICM for each treatment regime\n## in figures 2 and S3, grouped by treatment condition\nfigS4d <- ggplot(FGF.sum %>% \n                         ## Select embryos cultured for 48h\n                         ## for each treatment and regime to be plotted\n                         filter(Treatment != 'Littermate', \n                                Treatment != 'SU_10', \n                                Xpoint != 'xp', \n                                Regime != 'NA', \n                                Regime != 'R8', \n                                Regime != 'R9'), \n                 aes(x = Regime, y = Count))\n## Set up plot aesthetics\nfigS4d <- figS4d + geom_boxplot(aes(fill = TE_ICM), color = I('black'), \n                                outlier.shape = 1)\nfigS4d <- figS4d + geom_jitter(aes(shape = TE_ICM), color = 'black', \n                               size = I(1.2))\nfigS4d <- figS4d + scale_fill_manual(values = idcols)\nfigS4d <- figS4d + theme_bw() + facet_grid( ~ Treatment) + coord_fixed(1/20)\nfigS4d <- figS4d + labs(fill = 'Identity', x = 'Regime', y = 'Cell number')\n## Print plot to the screen\nprint(figS4d)",
    "created" : 1539363965471.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3115849455",
    "id" : "ABE90FA",
    "lastKnownWriteTime" : 1538480560,
    "last_content_update" : 1538480560,
    "path" : "C:/Users/Strawbridge/Dropbox/nicholsLab/FgfDependentPopulationDynamics/DATA/theoretical/sheffield2018/saiz2016natureCommunications/saiz-et-al_2016-master/figures_2-S3toS4.R",
    "project_path" : "figures_2-S3toS4.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}